<%= form_for @visit, :html => { :class => 'form-horizontal' } do |f| %>
<% if @visit.errors.any? %>
  <div class="alert">
    <h2><%= pluralize(@visit.errors.count, "error") %> prohibited this visit from being saved:</h2>
    <ul>
    <% @visit.errors.full_messages.each do |msg| %>
      <li><%= msg %></li>
    <% end %>
    </ul>
  </div>
<% end %>

  <div class="control-group">
    <%#= f.label :patient_id, :class => 'control-label' %>
    <div class="controls">
      <%= f.hidden_field :patient_id, :class => 'text_field' %>
    </div>
  </div>
  <div class="control-group">
    <%= f.label :visit_date, :class => 'control-label' %>
    <div class="controls">
      <%= f.date_field :visit_date, class: "datepicker", data: {"date-format" => "yyyy-mm-dd"} %>
    </div>
  </div>
  <div class="control-group">
    <%= f.label :visit_reason, :class => 'control-label' %>
    <div class="controls">
      <%= f.text_field :visit_reason, :class => 'text_field' %>
    </div>
  </div>
	<!-- Add the test done in-house and order the tests that are outsourced here -->
	<h3> Medical tests:</h3>
	<div class="med-tests">
		<!-- :patient_id, :visit_id, :med_test_type_id, :measurement, :mearsurement_note, :ordered_at, :reviewed_at -->
		<%= f.fields_for :med_tests do | med_test | %>
		<!-- HIDDEN FIELD START HERE -->
			<%#= med_test.label :patient_id , class: "control-label"%>
			<%= med_test.hidden_field :patient_id, class: "number_field"%>
			<%#= med_test.label :visit_id , class: "control-label"%>
			<%= med_test.hidden_field :visit_id, class: "number_field"%>
			<%#= med_test.label :med_test_type_id , class: "control-label"%>
			<%= med_test.hidden_field :med_test_type_id, class: "number_field"%>
			<!-- HIDDEN FIELD END HERE -->
			<strong>
			  <%= med_test.text_field :med_test_type_short_name, disabled: "true" %>
		  </strong>
			<%#= med_test.label :measurement , class: "control-label"%>
			<%= med_test.number_field :measurement, class: "number_field"%>
			<%#= med_test.label :mearsurement_note , class: "control-label"%>
			<%= med_test.text_area :mearsurement_note, rows: 1, class: "input-large"%><br />
		<% end %>
	</div>
	<!-- tests end here -->
  <div class="control-group">
    <%= f.label :visit_note, :class => 'control-label' %>
    <div class="controls">
      <%= f.text_area :visit_note, rows: 4, :class => 'input-xxlarge' %>
    </div>
  </div>

  <div class="form-actions">
    <%= f.submit nil, :class => 'btn btn-primary' %>
    <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                visits_path, :class => 'btn' %>
  </div>
<% end %>