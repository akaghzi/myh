<%- model_class = Patient -%>
<% if @patient.errors.any? %>
<div class="alert">
	<h2><%= pluralize(@patient.errors.count, "error") %> prohibited this patient from being saved:</h2>
	<ul>
		<% @patient.errors.full_messages.each do |msg| %>
		<li><%= msg %></li>
		<% end %>
	</ul>
</div>
<% end %>
<div class="page-header">
	<h2>
		<span class="titlehighlight">
			<%= @patient.full_name.titleize %>
		</span>
		<span class="bluehighlight">
			<%= @patient.gender.titleize %>
		</span>
		<span class="titlehighlight">
			<%= @patient.age %>
		</span>
		<span class="bluehighlight">
			DOB:<%= @patient.date_of_birth %>
		</span>
	</h2>
	<h3>
		<%= "Phone: #{@patient.phone} Externalid: #{@patient.externalid}" %>
	</h3> 
</div>
<div class="row-fluid">
	<span class="span6">
		<h3 class="alert">
			Allergies:&nbsp
			<% if @allergies.blank? %>
			<p>No allergy found on record</p>
			<%= link_to 'Add Allergy', new_allergy_path(patient_id: @patient.id), class: "btn btn-small btn-primary" %>
			<% end %>
		</h3>
		<% @patient.allergies.each do | allergy |%>
		<dl class="dl-horizontal">
			<dt>
				Substance Name
			</dt>
			<dd>
				<%= allergy.substance_name %>
				<%= link_to 'Edit', edit_allergy_path(allergy.id), :class => 'btn btn-mini btn-info' %>
			</dd>
			<dt>
				Substance Type
			</dt>
			<dd>
				<%= allergy.substance_type %>
			</dd>
			<dt>
				Reaction Type
			</dt>
			<dd>
				<%= allergy.reaction %>
			</dd>
		</dl>
		<% end %>
		<%= link_to 'Add Allergy', new_allergy_path(patient_id: @patient.id), class: "btn btn-small btn-primary" %>

	</span>
	<span class="span6">
		<h3 class="alert">
			Current Medications:&nbsp
			<% if @current_medications.blank? %>
			p>No current medication found on record</p>
			<%= link_to 'Add Medications', new_current_medication_path(patient_id: @patient.id), 
									class: "btn btn-small btn-primary" %>	
				<% end%>		
			</h3>
			<% @patient.current_medications.each do | current_medication |%>
			<dl class="dl-horizontal">
				<dt>
					Medication Name
				</dt>
				<dd>
					<%= current_medication.name %>
					<%= link_to 'Edit', edit_current_medication_path(current_medication.id), :class => 'btn btn-mini btn-info' %>
				</dd>
				<dt>
					Dosage
				</dt>
				<dd>
					<%= current_medication.dosage %>
				</dd>
				<dt>
					Frequency
				</dt>
				<dd>
					<%= current_medication.frequency %>
				</dd>
			</dl>
			<% end %>
			<%= link_to 'Add Medications', new_current_medication_path(patient_id: @patient.id), 
									class: "btn btn-small btn-primary" %>	
		</span>
</div>
<div class="row-fluid">
		<span class	="span12">
			<h3>Visit Information:</h3>		
			<% @patient.visits.order("visit_date").each do|visit| %>
			<dl class="dl-horizontal">
				<dt>
					Visit Date:
				</dt>
				<dd>
					<%= visit.visit_date %>
				</dd>
				<dt>
					Visit Reason:
				</dt>
				<dd>
					<%= visit.visit_reason.capitalize %>
				</dd>
				<dt>
					Visit Note:
				</dt>
				<dd>
					<%= visit.visit_note %>
				</dd>
			</dl>
				<% if (visit.visit_date >= Date.today) %>
				<%= link_to 'Edit Visit', edit_visit_path(visit.id), :class => 'btn btn-small btn-info' %>
				<% end %>
			<% end %>
			<%= link_to 'Add Visit', new_visit_path(patient_id: @patient.id), class: "btn btn-small btn-primary" %>
		</span>	
</div>
<div class="row-fluid">	
		<span class="span6">
			<h3>
				Contact Info:&nbsp<%= link_to 'Edit', @contact_info, class: "btn btn-small btn-info" %>
			</h3>
			<%= render partial: @contact_info %>
		</span>
		<span class="span6">
			<h3>
				Insurance Info:&nbsp<%= link_to 'Edit', @insurance_info, class: "btn btn-small btn-info" %>
			</h3>
			<%= render partial: @insurance_info %>
		</span>
</div>

<div class="row-fluid">
		<span class="span12">
			<h3>Additional Information</h3>
			<div class="control-group">
				<% @patient.reg_answers.each do|ans| %>
				<p>
					<strong>Question: </strong><span class="control-label"><%= ans.reg_question_text.capitalize %></span><br />
					<strong>Answer:   </strong><span class="control-label"><%= ans.content  %></span>
				</p>
				<% end %>
			</div>
		</span>
</div>
<div class="row-fluid">
		<div class="form-actions">
			<%= link_to t('.back', :default => t("helpers.links.back")),
			root_path, :class => 'btn'  %>
			<%= link_to 'Edit Patient Profile',
			edit_patient_path(@patient), :class => 'btn btn-info' %>
		</div>
	</div>		
